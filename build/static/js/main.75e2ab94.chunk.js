(this.webpackJsonpreact=this.webpackJsonpreact||[]).push([[0],{100:function(e,t,n){},105:function(e,t,n){},106:function(e,t,n){},107:function(e,t,n){"use strict";n.r(t);var c=n(1),o=n(46),a=n.n(o),r=n(18),i=n.n(r),s=n(29),u=n(13),l=n(12),j=n(24),b=n(9),d=n(3),f=n(47),p=n.n(f),O=n(48),v=n.n(O),g=n(49),x={C:[0,0],D:[2,-1],E:[4,-2],F:[-1,1],G:[1,0],A:[3,-1],B:[5,-2]},h=function(e){if(("number"===typeof e||"string"===typeof e)&&e>0&&e<128)return+e;var t=Array.isArray(e)?e:function(e){var t=function(e){return/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)(\/\d+|)\s*(.*)\s*$/.exec(e)}(e);if(!t||t[5])return null;var n=x[t[1].toUpperCase()],c=t[2].replace(/x/g,"##").length;"b"===t[2][0]&&(c*=-1);var o=n[0]+7*c;return t[3]?[o,+t[3]+n[1]-4*c,t[4]?+t[4].substring(1):null]:[o]}(e);return!t||t.length<2?null:7*t[0]+12*t[1]+12},m=(n(98),n(0)),y=function(e){var t=e.number,n=e.activeNotes,c=e.onPlayNote,o=e.onStopNote;if(void 0===t||null==t||t<0||t>9)throw new Error("The octave "+t+" doesn't exists in a piano: valid range [0:8]");var a=Object.keys(x),r=function(e){var t=h(e);return Object.keys(n).includes(t.toString())};return Object(m.jsxs)("div",{className:"piano-octave",children:[Object(m.jsx)("div",{className:"piano-octave-white",children:a.map((function(e){return Object(m.jsx)(S,{note:e+t,active:r(e+t),onPlayNote:c,onStopNote:o},e+t)}))}),Object(m.jsxs)("div",{className:"piano-octave-black",children:[Object(m.jsx)(S,{half:!0}),a.slice(1).map((function(e){return Object(m.jsx)(S,{note:e+"b"+t,active:r(e+"b"+t),onPlayNote:c,onStopNote:o},e+"b"+t)})),Object(m.jsx)(S,{half:!0})]})]})},S=function(e){var t=e.note,n=e.half,c=e.active,o=e.onPlayNote,a=e.onStopNote,r=Object(g.a)(e,["note","half","active","onPlayNote","onStopNote"]);if(n)return Object(m.jsx)("button",{className:"black hidden half"});if(t.includes("Fb"))return Object(m.jsx)("button",{className:"black hidden"});var i=t;return"number"===typeof i&&(i=function(e){return CHROMATIC[e%12]+(Math.floor(e/12)-1)}(i)),Object(m.jsx)("button",Object(b.a)(Object(b.a)({className:(i.includes("b")?"black":"white")+(c?" active":""),"date-key":i,onMouseDown:function(){return o(h(i),1,!0)},onMouseUp:function(){return a(h(i),!0)}},r),{},{children:i.includes("b")?null:i}))},N=function(e){var t=e.octaves,n=e.activeNotes,c=e.onPlayNote,o=e.onStopNote;if(!t||t<1||t>9)throw new Error("Number of octaves not defined or outside valid range");return Object(m.jsx)("div",{className:"piano",children:Object(l.a)(Array(t)).map((function(e,t){return Object(m.jsx)(y,{number:t,activeNotes:n,onPlayNote:c,onStopNote:o},t)}))})},C=(n(100),function(e){e.octaves,Date.now(),Date.now(),Date.now();return Object(m.jsx)("div",{className:"piano-waterfall"})}),w=n(19),T=n(14),k=(n(105),function(e){var t=e.onClick,n=e.children;return Object(m.jsx)("button",{className:"menu-item",onClick:t,children:n})}),R=function(e){var t=e.isRecording,n=e.isPlayingRecording,c=e.onStartRecording,o=e.onStopRecording,a=e.onPlayRecording,r=e.onResetRecording,i=e.onLoop;return Object(m.jsxs)("div",{className:"menu-bar",children:[Object(m.jsx)(k,{onClick:function(){n?r():a()},children:Object(m.jsx)(w.a,{icon:n?T.d:T.c,color:"var(--button-color)",size:"2x"})}),Object(m.jsx)(k,{onClick:function(){t?o():c()},children:Object(m.jsx)(w.a,{icon:T.a,color:t?"var(--rec-button-color)":"var(--button-color)",size:"2x"})}),Object(m.jsx)(k,{onClick:i,children:Object(m.jsx)(w.a,{icon:T.e,color:"var(--button-color)",size:"2x"})}),Object(m.jsx)(k,{children:Object(m.jsx)(w.a,{icon:T.b,color:"var(--button-color)",size:"2x"})})]})},D=(n(106),new AudioContext),P=function(){var e=Object(c.useState)(null),t=Object(d.a)(e,2),n=t[0],o=t[1],a=Object(c.useState)(null),r=Object(d.a)(a,2),f=r[0],O=r[1],g=Object(c.useState)(""),x=Object(d.a)(g,2),h=x[0],y=x[1],S=Object(c.useState)([]),w=Object(d.a)(S,2),T=w[0],k=w[1],P=Object(c.useState)({}),A=Object(d.a)(P,2),M=A[0],U=A[1],_=Object(c.useState)(1),z=Object(d.a)(_,2),I=z[0],E=z[1],F=Object(c.useState)(!1),H=Object(d.a)(F,2),L=H[0],G=H[1],B=Object(c.useState)(0),J=Object(d.a)(B,2),q=J[0],K=J[1],V=Object(c.useState)(null),$=Object(d.a)(V,2),Q=$[0],W=$[1],X=Object(c.useState)("none"),Y=Object(d.a)(X,2),Z=Y[0],ee=Y[1],te=Object(c.useState)("none"),ne=Object(d.a)(te,2),ce=ne[0],oe=ne[1],ae=Object(c.useState)("\ud83c\udfb5 Play some notes..."),re=Object(d.a)(ae,2),ie=re[0],se=re[1],ue=Object(c.useState)(!1),le=Object(d.a)(ue,2),je=le[0],be=le[1],de=Object(c.useState)(!1),fe=Object(d.a)(de,2),pe=fe[0],Oe=fe[1],ve=Object(c.useState)(null),ge=Object(d.a)(ve,2),xe=ge[0],he=ge[1],me=Object(c.useState)(null),ye=Object(d.a)(me,2),Se=ye[0],Ne=ye[1],Ce=Object(c.useState)(!1),we=Object(d.a)(Ce,2),Te=we[0],ke=we[1],Re=Object(c.useState)(null),De=Object(d.a)(Re,2),Pe=De[0],Ae=De[1],Me=Object(c.useState)([]),Ue=Object(d.a)(Me,2),_e=Ue[0],ze=Ue[1],Ie=Object(c.useState)(null),Ee=Object(d.a)(Ie,2),Fe=Ee[0],He=Ee[1],Le=function(e){var t=setInterval((function(){var t=new Date(Date.now()-e);se(function(e){return(e.getUTCHours()<10?"0"+e.getUTCHours():e.getUTCHours())+":"+(e.getUTCMinutes()<10?"0"+e.getUTCMinutes():e.getUTCMinutes())+":"+(e.getUTCSeconds()<10?"0"+e.getUTCSeconds():e.getUTCSeconds())}(t))}),1e3);return Ae(t),t},Ge=Object(c.useCallback)((function(e,t,c){null!==t&&void 0!==t||(t=1);var o=f.play(e,D.currentTime,{gain:t,sustain:I,loop:1});if(U((function(t){return Object(b.a)(Object(b.a)({},t),{},Object(j.a)({},e.toString(),o))})),pe)if(0===_e.length){var a=Date.now();he(a),Le(a),ze((function(n){return[].concat(Object(l.a)(n),[{type:"note_on",pitch:e,velocity:t,time:0}])}))}else{var r=Date.now()-xe;ze((function(n){return[].concat(Object(l.a)(n),[{type:"note_on",pitch:e,velocity:t,time:r}])}))}c&&n.emit("note_on",{pitch:e,velocity:t})}),[n,I,pe,xe,f,_e]),Be=Object(c.useCallback)((function(e,t){if(t&&n.emit("note_off",{pitch:e}),U((function(t){if(e in t){var n=t[e];L?setTimeout((function(){return n.stop()}),1e3*I):n.stop(),delete t[e]}return Object(b.a)({},t)})),pe){var c=Date.now()-xe;ze((function(t){return[].concat(Object(l.a)(t),[{type:"note_off",pitch:e,velocity:0,time:c}])}))}}),[n,pe,xe]),Je=Object(c.useCallback)((function(e){var t=function(e){return{command:e.data[0]>>4,channel:15&e.data[0],pitch:e.data[1],velocity:e.data[2]/127}}(e),n=t.command,c=t.pitch,o=t.velocity;if(9===n||8===n){var a=c+12*q;8===n||0===o?Be(a,!0):9===n&&Ge(a,o,!0)}}),[q,Ge,Be]),qe=Object(c.useCallback)((function(){console.debug("Playing recording...",_e),be(!0);var e,t=Date.now(),n=Le(t),c=_e[_e.length-1],o=Object(u.a)(_e);try{var a=function(){var o=e.value,a=Date.now(),r=o.type,i=o.pitch,s=o.velocity,u=o.time;setTimeout((function(){if("note_on"===r?Ge(i,s,!0):Be(i,!0),o===c){var e=Se-xe,a=Date.now()-t;setTimeout((function(){clearInterval(n),Te?qe():(se("\ud83c\udfb5 Play some notes..."),be(!1))}),e-a)}}),t+u-a)};for(o.s();!(e=o.n()).done;)a()}catch(r){o.e(r)}finally{o.f()}}),[_e,Te,Se,xe,Ge,Be]),Ke=function(){var e=Object(s.a)(i.a.mark((function e(t){var n,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Creating virtual instrument...",t),n={from:"MusyngKite"},e.next=4,p.a.instrument(D,t,n);case 4:c=e.sent,console.debug("Created virtual instrument"),y(t),O(c);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){console.debug("Creating socket...");var e=v.a.connect("wss://151.15.81.174:5000",{transports:["websocket"]});o(e),console.debug("Connecting..."),e.on("connect",Object(s.a)(i.a.mark((function e(){var t,n,c,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("Connected"),console.debug("Getting instruments list..."),e.next=4,fetch("https://raw.githubusercontent.com/danigb/soundfont-player/master/names/musyngkite.json");case 4:return t=e.sent,e.next=7,t.json();case 7:return n=e.sent,k(n),console.debug("Done"),e.next=12,Ke("acoustic_grand_piano");case 12:return e.next=14,navigator.requestMIDIAccess();case 14:c=e.sent,W(c),(o=Array.from(c.inputs.values())).length>0&&ee(o[0].id);case 18:case"end":return e.stop()}}),e)})))),e.on("ping",(function(){return e.emit("pong")})),e.on("latency",He)}),[]),Object(c.useEffect)((function(){if(n&&f){var e=function(e){return Ge(e.pitch,e.velocity)},t=function(e){return Be(e.pitch)};return n.on("note_on",e),n.on("note_off",t),function(){n.off("note_on",e),n.off("note_off",t)}}}),[n,f,pe]),Object(c.useEffect)((function(){if(Q&&Z){console.debug("Updating input-output devices",Z,ce);var e,t=Object(u.a)(Q.inputs.values());try{for(t.s();!(e=t.n()).done;){e.value.onmidimessage=function(){}}}catch(l){t.e(l)}finally{t.f()}var n,c=null,o=Object(u.a)(Q.outputs.values());try{for(o.s();!(n=o.n()).done;){var a=n.value;a.id===ce&&(c=a)}}catch(l){o.e(l)}finally{o.f()}var r,i=Object(u.a)(Q.inputs.values());try{for(i.s();!(r=i.n()).done;){var s=r.value;s.id===Z&&(s.onmidimessage=function(e){c&&254!==e.data[0]&&c.send(e.data),Je(e)})}}catch(l){i.e(l)}finally{i.f()}return function(){var e,t=Object(u.a)(Q.inputs.values());try{for(t.s();!(e=t.n()).done;){e.value.onmidimessage=function(){}}}catch(l){t.e(l)}finally{t.f()}}}}),[Z,ce,Q,Je]),Object(m.jsxs)("div",{className:"App"+(pe?" recording":""),children:[Object(m.jsxs)("header",{children:[Object(m.jsxs)("div",{style:{display:"flex"},children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("p",{className:"message",children:ie}),Object(m.jsxs)("p",{className:"latency",children:["Loop: ",Te?"ON":"OFF"," | Latency: ",Fe," ms"]})]}),Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{style:{display:"flex",marginTop:"5px"},children:[Object(m.jsx)("p",{style:{fontSize:"16px"},children:"Midi input"}),Object(m.jsxs)("select",{value:Z,onChange:function(e){return ee(e.currentTarget.value)},children:[Q&&Array.from(Q.inputs.values()).map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)})),Object(m.jsx)("option",{value:"none",children:"None"})]})]}),Object(m.jsxs)("div",{style:{display:"flex",marginTop:"5px"},children:[Object(m.jsx)("p",{style:{fontSize:"16px"},children:"Midi output"}),Object(m.jsxs)("select",{value:ce,onChange:function(e){return oe(e.currentTarget.value)},children:[Q&&Array.from(Q.outputs.values()).map((function(e){return Object(m.jsx)("option",{value:e.id,children:e.name},e.id)})),Object(m.jsx)("option",{value:"none",children:"None"})]})]}),Object(m.jsxs)("div",{style:{display:"flex",marginTop:"5px"},children:[Object(m.jsx)("p",{style:{fontSize:"16px"},children:"Instrument"}),Object(m.jsx)("select",{value:h,onChange:function(e){return Ke(e.currentTarget.value)},children:T.map((function(e,t){return Object(m.jsx)("option",{value:e,children:e},t)}))})]})]}),Object(m.jsxs)("div",{children:[Object(m.jsxs)("div",{style:{display:"flex",marginTop:"5px"},children:[Object(m.jsx)("p",{style:{fontSize:"16px"},children:"Transposition"}),Object(m.jsx)("input",{type:"number",value:q,onChange:function(e){return K(e.currentTarget.value)}})]}),Object(m.jsxs)("div",{style:{display:"flex",marginTop:"5px",alignItems:"center"},children:[Object(m.jsx)("p",{style:{fontSize:"16px"},children:"Sustain"}),Object(m.jsx)("input",{type:"checkbox",value:L,onChange:function(e){return G(e.currentTarget.value)}})]}),Object(m.jsxs)("div",{style:{display:"flex",marginTop:"5px",alignItems:"center"},children:[Object(m.jsx)("p",{style:{fontSize:"16px"},children:"Volume"}),Object(m.jsx)("input",{type:"number",value:I,onChange:function(e){return E(e.currentTarget.value)}})]})]})]}),Object(m.jsx)(R,{isRecording:pe,isPlayingRecording:je,onStartRecording:function(){console.debug("Recording started..."),ze([]),he(null),Ne(null),se("00:00:00"),Oe(!0)},onStopRecording:function(){console.debug("Recording ended...",_e),Oe(!1),Ne(Date.now()),clearInterval(Pe),Ae(null),se("\ud83c\udfb5 Play some notes...")},onPlayRecording:qe,onResetRecording:function(){console.debug("Stopping recoring..."),se("Stopping recording..."),be(!1)},onLoop:function(){return ke(!Te)}})]}),Object(m.jsx)(C,{octaves:9}),Object(m.jsx)(N,{octaves:9,activeNotes:M,onPlayNote:Ge,onStopNote:Be})]})},A=document.getElementById("root");a.a.render(Object(m.jsx)(c.StrictMode,{children:Object(m.jsx)(P,{})}),A)},98:function(e,t,n){}},[[107,1,2]]]);
//# sourceMappingURL=main.75e2ab94.chunk.js.map